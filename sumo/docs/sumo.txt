>>>filepath:/fcoding/articles/<<<
>>>rensai_name:statbushknife<<<
>>>rensai_number:02<<<
>>>date:2010/11/03<<<
>>>title:第8回 大相撲のアノーマリー (1)<<<
>>>abs
（編集部）<<<

●今回の前口上

諸事情により一ヶ月半の間連載を空けてしまいました。申し訳ございませんでした。実は10月、11月の初めに用意した時事ネタがいろいろあるのですが、こちらは少し時代遅れになりましたので、もう少し寝かしてから提示したいと思います。

今回から数回は、大相撲の統計データをネタにして公になっているが混乱しているデータ(英語では"messy data"といいます）を如何にしてキレイにし、キレイにしたデータをどのように解析するかという一連の手順を提示します。データ解析を実務で行う場合には、いわばここが一番の肝の部分になり、それを具体的な事例を用いて解説しようと思っています。

●汚いデータをどうする？

この連載ので以前紹介した世界銀行のWeb APIサービスは、webにおける現在最も洗練されたデータ公開の方法の一つです。APIの仕様さえ守ればRESTインタフェースから誰でも必要な情報にアクセスでき、データを入手することが可能です。しかし、すべての組織や個人がこのように洗練した形でデータを公開しているわけではありません。むしろ、ほとんどのwebにある情報は、コンピュータの視点からみると混乱している汚いデータである、といっていいでしょう。

混乱している汚いデータの筆頭として、構造化を考えて記述されていないHTMLによるデータがあります。ポータルサイトにあるスポーツの勝敗表などがその代表例です。このようなwebにある情報を入手して必要なデータを取り出すことを、「HTMLスクレイピング」と言います。特定のURLやHTMLに依存して目的のデータを探すわけですから、スクレイピング対象のwebサイトのシステム変更やHTMLの仕様変更にとても弱く、スクレイピングプログラムはメンテナンスが大変ですぐに利用ができなくなりがちです。

最近はPerlのMechanizeやRubyのscrubytなどの高機能なスクレイピングフレームワークが出ていますが、そのスクレイピングフレームワークを利用しても、スクレイピングのプログラムはHTMLの特定タグや語をテキスト解析しながらプログラミングすることが必要です。変更に弱く、容易にプログラミングしにくいことは変わりません。

ここで問題を切り分けましょう。汚いデータがあるのは事実と認め、そのデータが容易に変更されることも事実と認めましょう。この二つの要件は所与であると。それでは、それらのデータを変更に対応できるように解析することについて、効率化を図ることにします。

仕様が変更になりがちな汚いHTMLを効率よくテキスト解析してデータを入手する。そのためには、探索的にHTMLを解析できること、一度解析した手順を何度も使い回せること、という二つの要件が必要です。今回はこの要件を満たすためのシステムとして、Google Refineを利用しましょう。

そして汚いデータの筆頭としてYahoo! Japanにある大相撲の取組結果をみます。このデータを取り上げたのは二つの理由があります。一つはHTMLの構造的に混乱しているのでテキスト解析のプログラミングが面倒なこと、もう一つは大相撲の取り組み結果は非常に面白い解析結果が知られていることです。

●Yahoo! Japanスポーツの大相撲の取り組み結果

Yahoo! Japanスポーツにおける大相撲の取り組み結果の表示は以下のとおりです。(http://sports.yahoo.co.jp/sumo/etc/torikumi/199901/>>>link:http://sports.yahoo.co.jp/sumo/etc/torikumi/199901/<<<)
>>>img:y!sumo.jpg<<<

このHTMLは以下のようになっています。

>>>code
...
<table border=0 cellpadding=2 cellspacing=1 width=95%>
<tr><td align="right">
☆は勝ち越し、★は負け越し
</td></tr>
</table>
<table border=3 cellpadding=2 cellspacing=1 width=95% bgcolor="#F5DEB3">
<tr>
<th width=48%><font size="+1">東</font></th>
<th width=4% nowrap>格<br>付</th>
<th width=48%><font size="+1">西</font></th>
</tr>
<tr align="center" valign="top">
  <td>
    <b>貴乃花　☆</b><br>
    8勝7敗<br>
    <table border=0 cellpadding=1 cellspacing=1>
      <tr align=center valign=top>
        <td>●<br>琴<br>錦</td>
        <td>●<br>土<br>佐<br>ノ<br>海</td>
        <td>○<br>魁<br>皇</td>
        <td>●<br>玉<br>春<br>日</td>
        <td>○<br>蒼<br>樹<br>山</td>
        <td>○<br>湊<br>富<br>士</td>
        <td>○<br>栃<br>東</td>
        <td>○<br>闘<br>牙</td>
        <td>○<br>出<br>島</td>
        <td>●<br>琴<br>竜</td>
        <td>○<br>時<br>津<br>海</td>
        <td>●<br>武<br>双<br>山</td>
        <td>○<br>琴<br>乃<br>若</td>
        <td>●<br>千<br>代<br>大<br>海</td>
        <td>●<br>武<br>蔵<br>丸</td>
      </tr>
    </table>
  </td>
...
<<<

番付表と同じ見目を保持させるためか、意味的に異なる勝敗の星と対戦相手が同じセルに書かれていて、対戦相手の名前も<br>タグで見かけ上縦書きにしています。もちろん、このくらいのHTMLなら正規表現を普通に使える方やScrubytの使い手でしたら、少し頑張れば試行錯誤しながらパースできるかもしれませんが、もっと簡単にパースできる方法があるとすればそれを使わない手はありません。

●大相撲のアノーマリー

世界的ベストセラーになった"Freaknomics"(邦訳「ヤバい経済学」)で「相撲の八百長疑惑」として知られましたが、その元ネタとなったのが以下のMark Duggan と Steven D. Levittの論文です。

”Winning Isn't Everything: Corruption in Sumo Wrestling" >>>link: http://pricetheory.uchicago.edu/levitt/Papers/DugganLevitt2002.pdf<<<

この論文でDugganとLevittは1989年から2000年までの十両以上の取組表、70程度の力士の対戦を解析して、不自然なアノーマリーを報告しました。それは、7勝8敗の力士の数が非常に少ないというものです。普通大相撲は一人の力士の取り組み数は場所あたり15回です。すると、勝ち越し・負け越しが決まるのは7勝8敗と8勝7敗のラインで、普通のランダムな対戦を考えるとどちらも同じ程度の出現数になるはずです。しかし、論文のFigure2をみると、明らかに7勝8敗が少なくて、8勝7敗が多いという「アノーマリー」が生じています。

>>>img:dugganLevvitf2.jpg<<<

論文はこのアノーマリーを更に詳しくみて、最終日の対戦において7勝7敗の力士が、すでに勝ち越しを決めている力士と対戦するときに、7勝7敗の力士が勝つ確率が高いこと、その他の起こりうる仮説を立て、仮説検定しても勝ち越し・負け越しのギリギリの当落線上にいる力士が勝ちやすいという傾向を統計解析で明らかにします。そして、ここからなぜ当落線上の力士が勝ちやすいかということを、経済学的なインセンテティブ構造からアネクドート的に記述します。ここでは詳しくは書きませんが、大変面白い論文なので機会があったら読むことを是非オススメします。

上記の論文は1989年から2000年のデータを利用していました。それでは、最近のデータを利用すればどうなるか？ということが当然気になります。それをこのシリーズで順を追って見ていきましょう。あまり隠すのも趣味が悪いので、先に結果だけを提示していきます。それは以下のグラフになります。

>>>img: sumoanorm.png<<<

赤の線が1999年1月場所から2010年9月場所までの勝敗結果の分布で、青緑の線が勝負がランダムに生じたと仮定したときに描かれる二項分布になります。これをみるとわかるように、あきらかに7勝8敗が少なくなっています。また、DugganとLevittの結果より、負け星が極端に多い力士と勝ち星が極端に多い力士の人数が多くなっていて、裾が広い分布になっています。このシリーズでは、まずはこの「大相撲のアノーマリー」を自分で確かめることを試みます。

●Google Refine

しかし、ここで問題が生じます。大相撲のデータは、世界銀行のRESTインタフェースのような、洗練したデータリポジトリから簡単に入手できるわけではない、ということです。そこで今回は前述したようにYahoo! Japanスポーツの大相撲の取り組み結果をスクレイピングして、データを入手することにします。そのために用いるのが、Google Refineです。

Google Refineは汚いデータをクリーニング/クレンジングするツールとしてGoogleのFreebaseチームがリリースしたオープンソース・ソフトウェアです。

特徴

インストール

実際の手順

●次回について

次回もまた、オープンソースのRを利用して、オープンデータにアクセスし、オープンアイディアの活用したいと思います。それでは、またお会いましょう。